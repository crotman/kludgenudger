


correlate_satd_pmd(
  code_location = "C:/doutorado/ant/ant-rel-1.10.10",
  output_file = here::here("temp/ant.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/joda-time/joda-time-2.10",
  output_file = here::here("temp/jodatime.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/joda-time/joda-time-2.10",
  output_file = here::here("temp/jodatime_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/spark-2.9.3", 
  output_file = here::here("temp/spark.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/netbeans-12.2.2",
  output_file = here::here("temp/netbeans.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/netbeans-12.2.2",
  output_file = here::here("temp/netbeans_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/netbeans-12.2.2",
  output_file = here::here("temp/netbeans_bags.rds"),
  bags = TRUE
)

correlate_satd_pmd(
  code_location = "C:/doutorado/pulsar-2.7.2/pulsar-2.7.2",
  output_file = here::here("temp/pulsar.rds"))

correlate_satd_pmd(
  code_location = "C:/doutorado/pulsar-2.7.2/pulsar-2.7.2",
  output_file = here::here("temp/pulsar_bags
                           "),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/RxJava-3.0.12/RxJava-3.0.12",
  output_file = here::here("temp/rxjava.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/glide-4.12.0/glide-4.12.0",
  output_file = here::here("temp/glide.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/kubernetes-10.0.1/java-client-parent-java-10.0.1",
  output_file = here::here("temp/kubernetes.rds")
)


 
correlate_satd_pmd(
  code_location = "C:/doutorado/lottie-android-3.7.0/lottie-android-3.7.0",
  output_file = here::here("temp/lottie.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/EventBus-3.2.0/EventBus-3.2.0",
  output_file = here::here("temp/eventbus.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/joda-money-1.0.1/joda-money-1.0.1",
  output_file = here::here("temp/jodamoney.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/dbeaver-21.0.5/dbeaver-21.0.5",
  output_file = here::here("temp/dbeaver.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/MPAndroidChart-3.1.0/MPAndroidChart-3.1.0",
  output_file = here::here("temp/mpandroidchart.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/checkstyle-checkstyle-8.42/checkstyle-checkstyle-8.42",
  output_file = here::here("temp/checkstyle.rds")
)

correlate_satd_pmd(
  code_location = "C:\doutorado\presto-0.253/presto-0.253",
  output_file = here::here("temp/presto.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/storm-2.2.0/storm-2.2.0",
  output_file = here::here("temp/storm.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/camel-camel-3.10.0/camel-camel-3.10.0",
  output_file = here::here("temp/camel.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/camel-camel-3.10.0/camel-camel-3.10.0",
  output_file = here::here("temp/camel_BAGS.rds"),
  bags = TRUE  
)


correlate_satd_pmd(
  code_location = "C:/doutorado/Activiti-7.1.338/Activiti-7.1.338",
  output_file = here::here("temp/activiti.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/Activiti-7.1.338/Activiti-7.1.338",
  output_file = here::here("temp/activiti_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/ExoPlayer-r2.14.0/ExoPlayer-r2.14.0",
  output_file = here::here("temp/exoplayer.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/ExoPlayer-r2.14.0/ExoPlayer-r2.14.0",
  output_file = here::here("temp/exoplayer_bags.rds"),
  bags = TRUE
)



correlate_satd_pmd(
  code_location = "C:/doutorado/hbase-rel-2.2.7/hbase-rel-2.2.7",
  output_file = here::here("temp/hbase.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/hbase-rel-2.2.7/hbase-rel-2.2.7",
  output_file = here::here("temp/hbase_bags.rds"),
  bags = TRUE
)



correlate_satd_pmd(
  code_location = "C:/doutorado/beam-2.29.0/beam-2.29.0",
  output_file = here::here("temp/beam.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/beam-2.29.0/beam-2.29.0",
  output_file = here::here("temp/beam_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/spring-security-5.5.0/spring-security-5.5.0",
  output_file = here::here("temp/spring.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/spring-security-5.5.0/spring-security-5.5.0",
  output_file = here::here("temp/spring_bags.rds"),
  bags = TRUE
)



correlate_satd_pmd(
  code_location = "C:/doutorado/tomcat-10.0.6/tomcat-10.0.6",
  output_file = here::here("temp/tomcat.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/tomcat-10.0.6/tomcat-10.0.6",
  output_file = here::here("temp/tomcat_bags.rds"),
  bags = TRUE
)



correlate_satd_pmd(
  code_location = "C:/doutorado/redisson-redisson-3.15.5/redisson-redisson-3.15.5",
  output_file = here::here("temp/redisson.rds")
)



correlate_satd_pmd(
  code_location = "C:/doutorado/redisson-redisson-3.15.5/redisson-redisson-3.15.5",
  output_file = here::here("temp/redisson_bags.rds"),
  bags = TRUE
)




correlate_satd_pmd(
  code_location = "C:/doutorado/flink-release-1.13.0/flink-release-1.13.0",
  output_file = here::here("temp/flink.rds")
)



correlate_satd_pmd(
  code_location = "C:/doutorado/flink-release-1.13.0/flink-release-1.13.0",
  output_file = here::here("temp/flink_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/jenkins-jenkins-2.293/jenkins-jenkins-2.293",
  output_file = here::here("temp/jenkins.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/jenkins-jenkins-2.293/jenkins-jenkins-2.293",
  output_file = here::here("temp/jenkins_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/ArgoUML/0_35",
  output_file = here::here("temp/argouml.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/ArgoUML/0_35",
  output_file = here::here("temp/argouml_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/kafka-2.7.1/kafka-2.7.1",
  output_file = here::here("temp/kafka.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/kafka-2.7.1/kafka-2.7.1",
  output_file = here::here("temp/kafka_bags.rds"),
  bags = TRUE
)


correlate_satd_pmd(
  code_location = "C:/doutorado/hive-rel-release-2.3.8/hive-rel-release-2.3.8",
  output_file = here::here("temp/hive.rds")
)


correlate_satd_pmd(
  code_location = "C:/doutorado/junit5-r5.7.2/junit5-r5.7.2",
  output_file = here::here("temp/junit.rds")
)

correlate_satd_pmd(
  code_location = "C:/doutorado/junit5-r5.7.2/junit5-r5.7.2",
  output_file = here::here("temp/junit_bags.rds"),
  bags = TRUE
)







resulbags_ant <- read_rds(here::here("temp/ant_bags.rds"))
resulbags_jodatime <- read_rds(here::here("temp/jodatime_bags.rds"))
resulbags_argouml <- read_rds(here::here("temp/argouml_bags.rds"))
resulbags_kafka <- read_rds(here::here("temp/kafka_bags.rds"))
resulbags_hive <- read_rds(here::here("temp/hive_bags.rds"))
resulbags_junit <- read_rds(here::here("temp/junit_bags.rds"))
resulbags_spark <- read_rds(here::here("temp/spark_bags.rds"))
resulbags_netbeans <- read_rds(here::here("temp/netbeans_bags.rds"))
resulbags_pulsar <- read_rds(here::here("temp/pulsar_bags.rds"))
resulbags_rxjava <- read_rds(here::here("temp/rxjava_bags.rds"))
resulbags_glide <- read_rds(here::here("temp/glide_bags.rds"))
resulbags_kubernetes <- read_rds(here::here("temp/kubernetes_bags.rds"))
resulbags_lottie <- read_rds(here::here("temp/lottie_bags.rds"))
resulbags_eventbus <- read_rds(here::here("temp/eventbus_bags.rds"))
resulbags_jodamoney <- read_rds(here::here("temp/jodamoney_bags.rds"))
resulbags_dbeaver <- read_rds(here::here("temp/dbeaver_bags.rds"))
resulbags_mpandroidchart <- read_rds(here::here("temp/mpandroidchart_bags.rds"))
resulbags_checkstyle <- read_rds(here::here("temp/checkstyle_bags.rds"))
resulbags_presto <- read_rds(here::here("temp/presto_bags.rds"))
resulbags_storm <- read_rds(here::here("temp/storm_bags.rds"))
resulbags_camel <- read_rds(here::here("temp/camel_bags.rds"))
resulbags_activiti <- read_rds(here::here("temp/activiti_bags.rds"))
resulbags_exoplayer <- read_rds(here::here("temp/exoplayer_bags.rds"))
resulbags_hbase <- read_rds(here::here("temp/hbase_bags.rds"))
resulbags_beam <- read_rds(here::here("temp/beam_bags.rds"))
resulbags_spring <- read_rds(here::here("temp/spring_bags.rds"))
resulbags_tomcat <- read_rds(here::here("temp/tomcat_bags.rds"))
resulbags_redisson  <- read_rds(here::here("temp/redisson_bags.rds"))
resulbags_flink  <- read_rds(here::here("temp/flink_bags.rds"))
resulbags_jenkins  <- read_rds(here::here("temp/jenkins_bags.rds"))




resultados_ant <- read_rds(here::here("temp/ant.rds"))
resultados_jodatime <- read_rds(here::here("temp/jodatime.rds"))
resultados_argouml <- read_rds(here::here("temp/argouml.rds"))
resultados_kafka <- read_rds(here::here("temp/kafka.rds"))
resultados_hive <- read_rds(here::here("temp/hive.rds"))
resultados_junit <- read_rds(here::here("temp/junit.rds"))
resultados_spark <- read_rds(here::here("temp/spark.rds"))
resultados_netbeans <- read_rds(here::here("temp/netbeans.rds"))
resultados_pulsar <- read_rds(here::here("temp/pulsar.rds"))
resultados_rxjava <- read_rds(here::here("temp/rxjava.rds"))
resultados_glide <- read_rds(here::here("temp/glide.rds"))
resultados_kubernetes <- read_rds(here::here("temp/kubernetes.rds"))
resultados_lottie <- read_rds(here::here("temp/lottie.rds"))
resultados_eventbus <- read_rds(here::here("temp/eventbus.rds"))
resultados_jodamoney <- read_rds(here::here("temp/jodamoney.rds"))
resultados_dbeaver <- read_rds(here::here("temp/dbeaver.rds"))
resultados_mpandroidchart <- read_rds(here::here("temp/mpandroidchart.rds"))
resultados_checkstyle <- read_rds(here::here("temp/checkstyle.rds"))
resultados_presto <- read_rds(here::here("temp/presto.rds"))
resultados_storm <- read_rds(here::here("temp/storm.rds"))
resultados_camel <- read_rds(here::here("temp/camel.rds"))
resultados_activiti <- read_rds(here::here("temp/activiti.rds"))
resultados_exoplayer <- read_rds(here::here("temp/exoplayer.rds"))
resultados_hbase <- read_rds(here::here("temp/hbase.rds"))
resultados_beam <- read_rds(here::here("temp/beam.rds"))
resultados_spring <- read_rds(here::here("temp/spring.rds"))
resultados_tomcat <- read_rds(here::here("temp/tomcat.rds"))
resultados_redisson  <- read_rds(here::here("temp/redisson.rds"))
resultados_flink  <- read_rds(here::here("temp/flink.rds"))
resultados_jenkins  <- read_rds(here::here("temp/jenkins.rds"))




resulbags_ant <- calculate_summaries_satd_alerts(resulbags_ant$data)
resulbags_jodatime <- calculate_summaries_satd_alerts(resulbags_jodatime$data)
resulbags_argouml <- calculate_summaries_satd_alerts(resulbags_argouml$data)
resulbags_kafka <- calculate_summaries_satd_alerts(resulbags_kafka$data)
resulbags_hive <- calculate_summaries_satd_alerts(resulbags_hive$data)
resulbags_junit <- calculate_summaries_satd_alerts(resulbags_junit$data)
resulbags_spark <- calculate_summaries_satd_alerts(resulbags_spark$data)
resulbags_netbeans <- calculate_summaries_satd_alerts(resulbags_netbeans$data)
resulbags_pulsar <- calculate_summaries_satd_alerts(resulbags_pulsar$data)
resulbags_rxjava <- calculate_summaries_satd_alerts(resulbags_rxjava$data)
resulbags_glide <- calculate_summaries_satd_alerts(resulbags_glide$data)
resulbags_kubernetes <- calculate_summaries_satd_alerts(resulbags_kubernetes$data)
resulbags_lottie <- calculate_summaries_satd_alerts(resulbags_lottie$data)
resulbags_eventbus <- calculate_summaries_satd_alerts(resulbags_eventbus$data)
resulbags_jodamoney <- calculate_summaries_satd_alerts(resulbags_jodamoney$data)
resulbags_dbeaver <- calculate_summaries_satd_alerts(resulbags_dbeaver$data)
resulbags_mpandroidchart <- calculate_summaries_satd_alerts(resulbags_mpandroidchart$data)
resulbags_checkstyle <- calculate_summaries_satd_alerts(resulbags_checkstyle$data)
resulbags_presto <- calculate_summaries_satd_alerts(resulbags_presto$data)
resulbags_storm <- calculate_summaries_satd_alerts(resulbags_storm$data)
resulbags_camel <- calculate_summaries_satd_alerts(resulbags_camel$data)
resulbags_activiti <- calculate_summaries_satd_alerts(resulbags_activiti$data)
resulbags_exoplayer <- calculate_summaries_satd_alerts(resulbags_exoplayer$data)
resulbags_hbase <- calculate_summaries_satd_alerts(resulbags_hbase$data)
resulbags_beam <- calculate_summaries_satd_alerts(resulbags_beam$data)
resulbags_spring <- calculate_summaries_satd_alerts(resulbags_spring$data)
resulbags_tomcat <- calculate_summaries_satd_alerts(resulbags_tomcat$data)
resulbags_redisson <- calculate_summaries_satd_alerts(resulbags_redisson$data)
resulbags_flink <- calculate_summaries_satd_alerts(resulbags_flink$data)
resulbags_jenkins <- calculate_summaries_satd_alerts(resulbags_jenkins$data)





resultados_ant <- calculate_summaries_satd_alerts(resultados_ant$data)
resultados_jodatime <- calculate_summaries_satd_alerts(resultados_jodatime$data)
resultados_argouml <- calculate_summaries_satd_alerts(resultados_argouml$data)
resultados_kafka <- calculate_summaries_satd_alerts(resultados_kafka$data)
resultados_hive <- calculate_summaries_satd_alerts(resultados_hive$data)
resultados_junit <- calculate_summaries_satd_alerts(resultados_junit$data)
resultados_spark <- calculate_summaries_satd_alerts(resultados_spark$data)
resultados_netbeans <- calculate_summaries_satd_alerts(resultados_netbeans$data)
resultados_pulsar <- calculate_summaries_satd_alerts(resultados_pulsar$data)
resultados_rxjava <- calculate_summaries_satd_alerts(resultados_rxjava$data)
resultados_glide <- calculate_summaries_satd_alerts(resultados_glide$data)
resultados_kubernetes <- calculate_summaries_satd_alerts(resultados_kubernetes$data)
resultados_lottie <- calculate_summaries_satd_alerts(resultados_lottie$data)
resultados_eventbus <- calculate_summaries_satd_alerts(resultados_eventbus$data)
resultados_jodamoney <- calculate_summaries_satd_alerts(resultados_jodamoney$data)
resultados_dbeaver <- calculate_summaries_satd_alerts(resultados_dbeaver$data)
resultados_mpandroidchart <- calculate_summaries_satd_alerts(resultados_mpandroidchart$data)
resultados_checkstyle <- calculate_summaries_satd_alerts(resultados_checkstyle$data)
resultados_presto <- calculate_summaries_satd_alerts(resultados_presto$data)
resultados_storm <- calculate_summaries_satd_alerts(resultados_storm$data)
resultados_camel <- calculate_summaries_satd_alerts(resultados_camel$data)
resultados_activiti <- calculate_summaries_satd_alerts(resultados_activiti$data)
resultados_exoplayer <- calculate_summaries_satd_alerts(resultados_exoplayer$data)
resultados_hbase <- calculate_summaries_satd_alerts(resultados_hbase$data)
resultados_beam <- calculate_summaries_satd_alerts(resultados_beam$data)
resultados_spring <- calculate_summaries_satd_alerts(resultados_spring$data)
resultados_tomcat <- calculate_summaries_satd_alerts(resultados_tomcat$data)
resultados_redisson <- calculate_summaries_satd_alerts(resultados_redisson$data)
resultados_flink <- calculate_summaries_satd_alerts(resultados_flink$data)
resultados_jenkins <- calculate_summaries_satd_alerts(resultados_jenkins$data)






resulbags_ant$summarised_data
resulbags_jodatime$summarised_data
resulbags_argouml$summarised_data
resulbags_kafka$summarised_data
resulbags_hive$summarised_data
resulbags_junit$summarised_data
resulbags_spark$summarised_data
resulbags_netbeans$summarised_data
resulbags_pulsar$summarised_data
resulbags_rxjava$summarised_data
resulbags_glide$summarised_data
resulbags_kubernetes$summarised_data
resulbags_lottie$summarised_data
resulbags_eventbus$summarised_data
resulbags_jodamoney$summarised_data
resulbags_dbeaver$summarised_data
resulbags_mpandroidchart$summarised_data
resulbags_checkstyle$summarised_data
resulbags_presto$summarised_data
resulbags_storm$summarised_data
resulbags_camel$summarised_data
resulbags_activiti$summarised_data
resulbags_exoplayer$summarised_data
resulbags_hbase$summarised_data
resulbags_beam$summarised_data
resulbags_flatbuffers$summarised_data
resulbags_spring$summarised_data
resulbags_tomcat$summarised_data
resulbags_redisson$summarised_data
resulbags_flink$summarised_data
resulbags_jenkins$summarised_data


resulbags_jodatime$p_value 
resulbags_ant$p_value
resulbags_argouml$p_value
resulbags_kafka$p_value
resulbags_hive$p_value
resulbags_junit$p_value
resulbags_spark$p_value
resulbags_netbeans$p_value
resulbags_pulsar$p_value
resulbags_rxjava$p_value
resulbags_glide$p_value
resulbags_kubernetes$p_value
resulbags_lottie$p_value
resulbags_eventbus$p_value
resulbags_jodamoney$p_value
resulbags_dbeaver$p_value
resulbags_mpandroidchart$p_value
resulbags_checkstyle$p_value
resulbags_presto$p_value
resulbags_storm$p_value
resulbags_camel$p_value
resulbags_activiti$p_value
resulbags_exoplayer$p_value



extract_summary <- function(name, prefix = "resultado"){
  

  if (str_detect(string = name, pattern = prefix)){
    
    local_results <- .GlobalEnv[[name]]
    
    n_classes <- local_results$data$class_blocks %>% unique() %>% length()
    
    n_methods <- local_results$data %>% 
      count(          package_blocks,
                      class_blocks,
                      method_blocks,
                      id_blocks
      ) %>% 
      nrow()
    
    n_methods_satd <- local_results$n_satd
    
    prop_alerts_satd <- local_results$prop_satd
    
    prop_alerts_no_satd <- local_results$prop_no_satd
    
    greater_class <- if_else(prop_alerts_no_satd > prop_alerts_satd, "NO SATD", "SATD" )
    
    p_value <- local_results$p_value
    
    output <- tibble(
      project = str_remove(string = name, pattern = str_glue("{prefix}\\_")),
      n_classes = n_classes,
      n_methods = n_methods,
      n_methods_satd = n_methods_satd,      
      prop_alerts_satd = prop_alerts_satd,
      prop_alerts_no_satd = prop_alerts_no_satd,
      greater_class = greater_class,
      p_value = p_value
    )
    
    
  } else {
    output <- NULL  
  }
  
  print(name)
   
  output
   
}



extract_data <- function(name, prefix = "resultado" ){
  
  
  if (str_detect(string = name, pattern = prefix)){
    
    local_results <- .GlobalEnv[[name]]
    
    output <- local_results$data %>% 
      mutate(
        project = str_remove(string = name, pattern = str_glue("{prefix}\\_") )
      ) %>% 
      select(
        -code_blocks
      )
    
  } else {
    output <- NULL  
  }
  
  print(name)
  
  output
  
}


outputs <- map_df(.x = names(.GlobalEnv), .f = ~extract_summary(name = .x, prefix = "resultados" ) )
outputs_bags <- map_df(.x = names(.GlobalEnv), .f = ~extract_summary(name = .x, prefix = "resulbags" ) )

outputs_data <- map_df(.x = names(.GlobalEnv), .f = ~extract_data(name = .x, prefix = "resultados") )
outputs_data_bags <- map_df(.x = names(.GlobalEnv), .f = ~extract_data(name = .x, prefix = "resulbags") )

write_rds(outputs_bags , here::here("report_satd_alert/output_bags.rds"))

feather::write_feather(outputs_data_bags, here::here("report_satd_alert/output_data_bags.feather"))
feather::write_feather(outputs_data, here::here("report_satd_alert/output_data.feather"))

data_regression <-  feather::read_feather(here::here("report_satd_alert/output_data.feather"))
data_regression_bags <-  feather::read_feather(here::here("report_satd_alert/output_data_bags.feather"))



data_regression_prepared <- data_regression %>% 
  mutate(
    size = endline_blocks - beginline_blocks
  ) %>% 
  filter(
    size > 3
  ) %>% 
  mutate(
    has_satd = if_else(has_satd, 1, 0)
  )

data_regression_prepared_bags <- data_regression_bags %>% 
  mutate(
    size = endline_blocks - beginline_blocks
  ) %>% 
  filter(
    size > 3
  ) %>% 
  mutate(
    has_satd = if_else(has_satd, 1, 0)
  )


modelo <- glm(data = data_regression_prepared, formula = has_alert ~ has_satd + log(size), family = "binomial" )

write_rds(modelo, here::here("report_satd_alert/modelo.rds"))

modelo_bags <- glm(data = data_regression_prepared_bags, formula = has_alert ~ has_satd + log(size), family = "binomial" )

write_rds(modelo_bags, here::here("report_satd_alert/modelo_bags.rds"))


summary(modelo_bags)


